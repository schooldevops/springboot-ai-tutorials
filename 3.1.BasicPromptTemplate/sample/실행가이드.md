# PromptTemplate 샘플 프로젝트 실행 가이드

이 가이드는 3.1.BasicPromptTemplate 샘플 프로젝트를 실행하고 테스트하는 방법을 안내합니다.

## 📋 사전 준비사항

- JDK 17 이상 설치
- OpenAI API Key 발급
- 환경 변수 설정 권한

## 🚀 실행 방법

### 1. 환경 변수 설정

터미널에서 API Key를 환경 변수로 설정:

**macOS / Linux:**
```bash
export OPENAI_API_KEY="sk-your-api-key-here"
```

**Windows (PowerShell):**
```powershell
$env:OPENAI_API_KEY="sk-your-api-key-here"
```

### 2. 프로젝트 실행

```bash
./gradlew bootRun
```

또는 IntelliJ IDEA에서 `PromptTemplateApplication.kt` 실행

### 3. 실행 확인

애플리케이션이 정상적으로 시작되면 다음과 같은 메시지가 표시됩니다:

```
Started PromptTemplateApplication in X.XXX seconds
```

## 🧪 API 테스트

### 기본 예제

#### 1. 단순 인사 (변수 1개)

```bash
curl http://localhost:8080/api/basic/greet/홍길동
```

**예상 응답:**
```
안녕하세요 홍길동님! 간단히 자기소개 해주세요에 대한 응답...
```

#### 2. 개인화된 채팅 (여러 변수)

```bash
curl -X POST http://localhost:8080/api/basic/personalized \
  -H "Content-Type: application/json" \
  -d '{
    "name": "홍길동",
    "job": "개발자",
    "interest": "AI"
  }'
```

**예상 응답:**
```json
당신은 홍길동님의 개인 어시스턴트입니다...
```

#### 3. 질문 답변

```bash
curl -X POST http://localhost:8080/api/basic/question \
  -H "Content-Type: application/json" \
  -d '{
    "userName": "홍길동",
    "question": "Spring AI에 대해 설명해주세요"
  }'
```

### 고급 예제

#### 4. 이메일 생성

```bash
curl -X POST http://localhost:8080/api/advanced/email \
  -H "Content-Type: application/json" \
  -d '{
    "recipient": "김철수",
    "subject": "회의 일정 안내",
    "purpose": "다음 주 회의 일정을 안내합니다",
    "requirements": "간결하고 정중하게"
  }'
```

#### 5. 코딩 도우미

```bash
curl -X POST http://localhost:8080/api/advanced/code-help \
  -H "Content-Type: application/json" \
  -d '{
    "language": "Kotlin",
    "framework": "Spring Boot",
    "question": "의존성 주입이란 무엇인가요?",
    "context": "Spring Boot 프로젝트에서 사용 중"
  }'
```

#### 6. 번역 서비스

```bash
curl -X POST http://localhost:8080/api/advanced/translate \
  -H "Content-Type: application/json" \
  -d '{
    "sourceLanguage": "한국어",
    "targetLanguage": "영어",
    "text": "안녕하세요, 반갑습니다!"
  }'
```

### 서비스 기반 예제

#### 7. 서비스를 통한 인사말

```bash
curl http://localhost:8080/api/service/greet/홍길동
```

#### 8. 서비스를 통한 질문 답변

```bash
curl -X POST http://localhost:8080/api/service/ask \
  -H "Content-Type: application/json" \
  -d '{
    "userName": "홍길동",
    "question": "Kotlin의 주요 특징은?",
    "context": "Spring Boot 프로젝트"
  }'
```

#### 9. 내용 요약

```bash
curl -X POST http://localhost:8080/api/service/summarize \
  -H "Content-Type: application/json" \
  -d '{
    "content": "Spring AI는 Spring 생태계에서 AI 기능을 통합하는 프레임워크입니다. 이를 통해 개발자들은 쉽게 LLM과 상호작용할 수 있습니다..."
  }'
```

## 📊 Postman 사용

Postman을 사용하는 경우:

### Collection 예시

**1. Basic Greet**
- Method: GET
- URL: `http://localhost:8080/api/basic/greet/홍길동`

**2. Personalized Chat**
- Method: POST
- URL: `http://localhost:8080/api/basic/personalized`
- Body (JSON):
```json
{
  "name": "홍길동",
  "job": "개발자",
  "interest": "AI"
}
```

**3. Email Generation**
- Method: POST
- URL: `http://localhost:8080/api/advanced/email`
- Body:
```json
{
  "recipient": "김철수",
  "subject": "회의 일정",
  "purpose": "다음 주 회의 일정 안내",
  "requirements": "간결하게"
}
```

## 🔍 디버깅

### 로그 확인

애플리케이션 실행 시 로그를 확인하여 디버깅할 수 있습니다:

```yaml
# application.yml에 이미 설정됨
logging:
  level:
    com.example.springai: DEBUG
    org.springframework.ai: DEBUG
```

### 템플릿 변수 확인

코드에 로그를 추가하여 템플릿 변수가 올바르게 바인딩되는지 확인:

```kotlin
val prompt = template.create(mapOf("name" to name))
println("Generated prompt: $prompt")  // 디버깅용
```

## ❌ 문제 해결

### 문제 1: API Key 오류

**증상:**
```
Error: API key not found
```

**해결책:**
1. 환경 변수 확인: `echo $OPENAI_API_KEY`
2. 애플리케이션 재시작

### 문제 2: 변수가 치환되지 않음

**증상:**
템플릿에 `{name}`이 그대로 출력됨

**해결책:**
- 변수 이름 확인 (대소문자 구분)
- Map의 키가 템플릿의 변수명과 정확히 일치하는지 확인

### 문제 3: 컴파일 오류

**증상:**
```
None of the following functions can be called with the arguments supplied
```

**해결책:**
`PromptTemplate.create()`는 `Prompt` 객체를 직접 반환합니다:

```kotlin
val prompt = template.create(mapOf("name" to name))  // ✅ 올바른 방법
// 이미 Prompt 객체이므로 바로 사용 가능
```

## ✅ 체크리스트

실행 전 확인사항:

- [ ] JDK 17 이상 설치됨
- [ ] OpenAI API Key 발급됨
- [ ] 환경 변수 설정됨
- [ ] 프로젝트 빌드 성공 (`./gradlew build`)
- [ ] 애플리케이션 실행 성공 (`./gradlew bootRun`)
- [ ] API 엔드포인트 응답 확인

## 🎓 학습 권장 순서

1. **기본 사용법**: `/api/basic/greet`, `/api/basic/personalized`
2. **고급 활용**: `/api/advanced/*` 엔드포인트들
3. **서비스 분리**: `/api/service/*` 엔드포인트들
4. **코드 분석**: 각 컨트롤러와 서비스의 코드를 읽어보며 학습

## 📚 핵심 개념 정리

### PromptTemplate 사용 패턴

```kotlin
// 1. 템플릿 생성
val template = PromptTemplate("템플릿 문자열 {변수명}")

// 2. 변수 바인딩하여 Prompt 직접 생성
val prompt = template.create(mapOf("변수명" to "값"))

// 3. ChatModel 호출
val response = chatModel.call(prompt)
val result = response.results.firstOrNull()?.output?.text ?: "응답 없음"
```

> 💡 **중요**: `template.create()`는 `Prompt` 객체를 직접 반환하므로 추가 변환이 필요 없습니다.

---

**다음 학습**: [3.2: 고급 PromptTemplate 활용](../../README.md#32-고급-prompttemplate-활용)

