# BeanOutputParser ìƒ˜í”Œ í”„ë¡œì íŠ¸ ì‹¤í–‰ ê°€ì´ë“œ

ì´ ê°€ì´ë“œëŠ” 4.1.BeanOutputParserNDataClass ìƒ˜í”Œ í”„ë¡œì íŠ¸ë¥¼ ì‹¤í–‰í•˜ê³  í…ŒìŠ¤íŠ¸í•˜ëŠ” ë°©ë²•ì„ ì•ˆë‚´í•©ë‹ˆë‹¤.

## ğŸ“‹ ì‚¬ì „ ì¤€ë¹„ì‚¬í•­

- JDK 17 ì´ìƒ ì„¤ì¹˜
- OpenAI API Key ë°œê¸‰
- í™˜ê²½ ë³€ìˆ˜ ì„¤ì • ê¶Œí•œ

## ğŸš€ ì‹¤í–‰ ë°©ë²•

### 1. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

í„°ë¯¸ë„ì—ì„œ API Keyë¥¼ í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì •:

**macOS / Linux:**
```bash
export OPENAI_API_KEY="sk-your-api-key-here"
```

**Windows (PowerShell):**
```powershell
$env:OPENAI_API_KEY="sk-your-api-key-here"
```

### 2. í”„ë¡œì íŠ¸ ì‹¤í–‰

```bash
./gradlew bootRun
```

ë˜ëŠ” IntelliJ IDEAì—ì„œ `BeanParserApplication.kt` ì‹¤í–‰

### 3. ì‹¤í–‰ í™•ì¸

ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì •ìƒì ìœ¼ë¡œ ì‹œì‘ë˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë©”ì‹œì§€ê°€ í‘œì‹œë©ë‹ˆë‹¤:

```
Started BeanParserApplication in X.XXX seconds
```

## ğŸ§ª API í…ŒìŠ¤íŠ¸

### ê¸°ë³¸ íŒŒì‹± ì˜ˆì œ

#### 1. ì‚¬ìš©ì ì •ë³´ íŒŒì‹±

```bash
curl -X POST http://localhost:8080/api/basic-parser/user-info \
  -H "Content-Type: application/json" \
  -d '{
    "question": "ì‚¬ìš©ì ì •ë³´ë¥¼ ì œê³µí•´ì£¼ì„¸ìš”. ì´ë¦„ì€ í™ê¸¸ë™, ë‚˜ì´ëŠ” 30, ì´ë©”ì¼ì€ hong@example.comì…ë‹ˆë‹¤."
  }'
```

**ì˜ˆìƒ ì‘ë‹µ:**
```json
{
  "name": "í™ê¸¸ë™",
  "age": 30,
  "email": "hong@example.com"
}
```

#### 2. í”„ë¡œí•„ ì •ë³´ íŒŒì‹± (Nullable í•„ë“œ)

```bash
curl -X POST http://localhost:8080/api/basic-parser/profile \
  -H "Content-Type: application/json" \
  -d '{
    "question": "í™ê¸¸ë™ì— ëŒ€í•œ í”„ë¡œí•„ ì •ë³´ë¥¼ ì œê³µí•´ì£¼ì„¸ìš”."
  }'
```

### ê³ ê¸‰ íŒŒì‹± ì˜ˆì œ

#### 3. ì œí’ˆ ì •ë³´ íŒŒì‹± (ë¦¬ìŠ¤íŠ¸ í¬í•¨)

```bash
curl -X POST http://localhost:8080/api/advanced-parser/product \
  -H "Content-Type: application/json" \
  -d '{
    "description": "ìŠ¤ë§ˆíŠ¸í° ì œí’ˆì…ë‹ˆë‹¤. ê°€ê²©ì€ 100ë§Œì›ì…ë‹ˆë‹¤. ì¹´ë©”ë¼, ë°°í„°ë¦¬, ë””ìŠ¤í”Œë ˆì´ ê¸°ëŠ¥ì´ ìˆìŠµë‹ˆë‹¤."
  }'
```

**ì˜ˆìƒ ì‘ë‹µ:**
```json
{
  "name": "ìŠ¤ë§ˆíŠ¸í°",
  "price": 1000000.0,
  "category": "ì „ìì œí’ˆ",
  "description": "ìŠ¤ë§ˆíŠ¸í° ì œí’ˆì…ë‹ˆë‹¤.",
  "features": ["ì¹´ë©”ë¼", "ë°°í„°ë¦¬", "ë””ìŠ¤í”Œë ˆì´"]
}
```

#### 4. íšŒì‚¬ ì •ë³´ íŒŒì‹± (ì¤‘ì²© êµ¬ì¡°)

```bash
curl -X POST http://localhost:8080/api/advanced-parser/company \
  -H "Content-Type: application/json" \
  -d '{
    "question": "Spring Corp íšŒì‚¬ ì •ë³´ë¥¼ ì œê³µí•´ì£¼ì„¸ìš”. ì£¼ì†ŒëŠ” ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ, ìš°í¸ë²ˆí˜¸ëŠ” 06142, êµ­ê°€ëŠ” í•œêµ­ì…ë‹ˆë‹¤. ì§ì› ìˆ˜ëŠ” 100ëª…ì…ë‹ˆë‹¤."
  }'
```

### ì•ˆì „í•œ íŒŒì‹± ì˜ˆì œ

#### 5. ì—ëŸ¬ ì²˜ë¦¬ í¬í•¨

```bash
curl -X POST http://localhost:8080/api/safe-parser/parse \
  -H "Content-Type: application/json" \
  -d '{
    "question": "ì‚¬ìš©ì ì •ë³´ë¥¼ ì œê³µí•´ì£¼ì„¸ìš”."
  }'
```

**ì„±ê³µ ì‘ë‹µ:**
```json
{
  "success": true,
  "data": {
    "name": "í™ê¸¸ë™",
    "age": 30,
    "email": "hong@example.com"
  }
}
```

**ì‹¤íŒ¨ ì‘ë‹µ:**
```json
{
  "success": false,
  "error": "JSON íŒŒì‹± ì‹¤íŒ¨: ...",
  "errorType": "IllegalArgumentException"
}
```

### ì„œë¹„ìŠ¤ ê¸°ë°˜ ì˜ˆì œ

#### 6. ì„œë¹„ìŠ¤ë¥¼ í†µí•œ ì‚¬ìš©ì ì •ë³´ íŒŒì‹±

```bash
curl -X POST http://localhost:8080/api/service-parser/user \
  -H "Content-Type: application/json" \
  -d '{
    "question": "ì‚¬ìš©ì ì •ë³´ë¥¼ ì¶”ì¶œí•´ì£¼ì„¸ìš”."
  }'
```

#### 7. ë ˆì‹œí”¼ íŒŒì‹±

```bash
curl -X POST http://localhost:8080/api/service-parser/recipe \
  -H "Content-Type: application/json" \
  -d '{
    "question": "ê¹€ì¹˜ì°Œê°œ ë ˆì‹œí”¼ë¥¼ ì œê³µí•´ì£¼ì„¸ìš”."
  }'
```

## ğŸ“Š Postman ì‚¬ìš©

Postmanì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°:

### Collection ì˜ˆì‹œ

**1. ê¸°ë³¸ íŒŒì‹±**
- Method: POST
- URL: `http://localhost:8080/api/basic-parser/user-info`
- Body (JSON):
```json
{
  "question": "ì‚¬ìš©ì ì •ë³´ë¥¼ ì œê³µí•´ì£¼ì„¸ìš”."
}
```

**2. ì•ˆì „í•œ íŒŒì‹±**
- Method: POST
- URL: `http://localhost:8080/api/safe-parser/parse`
- Body:
```json
{
  "question": "ì‚¬ìš©ì ì •ë³´ë¥¼ ì œê³µí•´ì£¼ì„¸ìš”."
}
```

## ğŸ” ë””ë²„ê¹…

### ë¡œê·¸ í™•ì¸

ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì‹œ ë¡œê·¸ë¥¼ í™•ì¸í•˜ì—¬ ë””ë²„ê¹…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```yaml
# application.ymlì— ì´ë¯¸ ì„¤ì •ë¨
logging:
  level:
    com.example.springai: DEBUG
    org.springframework.ai: DEBUG
```

### JSON íŒŒì‹± ë””ë²„ê¹…

ì½”ë“œì— ë¡œê·¸ë¥¼ ì¶”ê°€í•˜ì—¬ íŒŒì‹± ê³¼ì •ì„ í™•ì¸:

```kotlin
val response = chatModel.call(prompt)
val text = response.results.firstOrNull()?.output?.text ?: ""
println("Raw response: $text")  // ë””ë²„ê¹…ìš©

val cleanedJson = JsonCleaner.cleanJsonText(text)
println("Cleaned JSON: $cleanedJson")  // ë””ë²„ê¹…ìš©

val userInfo = parser.parse(cleanedJson)
```

## âŒ ë¬¸ì œ í•´ê²°

### ë¬¸ì œ 1: íŒŒì‹± ì‹¤íŒ¨

**ì¦ìƒ:**
```
IllegalArgumentException: JSON íŒŒì‹± ì‹¤íŒ¨
```

**ì›ì¸**: LLM ì‘ë‹µì´ JSON í˜•ì‹ì´ ì•„ë‹ˆê±°ë‚˜ í•„ë“œ ë¶ˆì¼ì¹˜

**í•´ê²°ì±…:**
1. Format ë©”ì‹œì§€ë¥¼ ëª…í™•íˆ ì „ë‹¬
2. ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸
3. SafeParserController ì‚¬ìš© (ìë™ ì—ëŸ¬ ì²˜ë¦¬)

### ë¬¸ì œ 2: í•„ë“œ íƒ€ì… ë¶ˆì¼ì¹˜

**ì¦ìƒ:**
```
Cannot deserialize value of type `Int` from String
```

**ì›ì¸**: LLMì´ ìˆ«ìë¥¼ ë¬¸ìì—´ë¡œ ë°˜í™˜

**í•´ê²°ì±…:**
```kotlin
// Data Classì—ì„œ íƒ€ì… í™•ì¸
data class UserInfo(
    val name: String,
    val age: Int,  // LLMì´ ìˆ«ìë¡œ ë°˜í™˜í•˜ë„ë¡ ëª…ì‹œ
    val email: String
)
```

### ë¬¸ì œ 3: Optional í•„ë“œ ëˆ„ë½

**ì¦ìƒ:**
```
MissingRequiredPropertyException
```

**ì›ì¸**: í•„ìˆ˜ í•„ë“œê°€ LLM ì‘ë‹µì— ì—†ìŒ

**í•´ê²°ì±…:**
```kotlin
// Nullable íƒ€ì…ìœ¼ë¡œ ë³€ê²½
data class UserProfile(
    val name: String,
    val age: Int? = null,  // ì„ íƒì 
    val email: String?
)
```

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

ì‹¤í–‰ ì „ í™•ì¸ì‚¬í•­:

- [ ] JDK 17 ì´ìƒ ì„¤ì¹˜ë¨
- [ ] OpenAI API Key ë°œê¸‰ë¨
- [ ] í™˜ê²½ ë³€ìˆ˜ ì„¤ì •ë¨
- [ ] í”„ë¡œì íŠ¸ ë¹Œë“œ ì„±ê³µ (`./gradlew build`)
- [ ] ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì„±ê³µ (`./gradlew bootRun`)
- [ ] API ì—”ë“œí¬ì¸íŠ¸ ì‘ë‹µ í™•ì¸

## ğŸ“ í•™ìŠµ ê¶Œì¥ ìˆœì„œ

1. **ê¸°ë³¸ íŒŒì‹±**: `/api/basic-parser/*` ì—”ë“œí¬ì¸íŠ¸ë“¤
2. **ê³ ê¸‰ íŒŒì‹±**: `/api/advanced-parser/*` ì—”ë“œí¬ì¸íŠ¸ë“¤
3. **ì—ëŸ¬ ì²˜ë¦¬**: `/api/safe-parser/*` ì—”ë“œí¬ì¸íŠ¸ë“¤
4. **ì„œë¹„ìŠ¤ ë¶„ë¦¬**: `/api/service-parser/*` ì—”ë“œí¬ì¸íŠ¸ë“¤
5. **ì½”ë“œ ë¶„ì„**: BeanOutputParser êµ¬í˜„ ë° JsonCleaner í™•ì¸

## ğŸ“š í•µì‹¬ ê°œë… ì •ë¦¬

### BeanOutputParser ì‚¬ìš© íŒ¨í„´

```kotlin
// 1. Parser ìƒì„±
val parser = BeanOutputParser(UserInfo::class.java)
val format = parser.format

// 2. Prompt ìƒì„± (Format í¬í•¨)
val prompt = Prompt(
    listOf(
        SystemMessage("ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•´ì£¼ì„¸ìš”:\n$format"),
        UserMessage("ì‚¬ìš©ì ì •ë³´ë¥¼ ì œê³µí•´ì£¼ì„¸ìš”")
    )
)

// 3. LLM í˜¸ì¶œ
val response = chatModel.call(prompt)
val text = response.results.firstOrNull()?.output?.text ?: ""

// 4. JSON ì •ë¦¬
val cleanedJson = JsonCleaner.cleanJsonText(text)

// 5. íŒŒì‹±
val userInfo: UserInfo = parser.parse(cleanedJson)
```

### Data Class ì„¤ê³„ íŒ¨í„´

```kotlin
// âœ… ì¢‹ì€ ì˜ˆ: ëª…í™•í•œ í•„ë“œëª…ê³¼ íƒ€ì…
data class UserInfo(
    val name: String,
    val age: Int,
    val email: String
)

// âœ… Nullable í•„ë“œ ì‚¬ìš© (ì„ íƒì  í•„ë“œ)
data class UserProfile(
    val name: String,
    val age: Int? = null,
    val email: String?
)

// âœ… ì¤‘ì²© êµ¬ì¡°
data class CompanyInfo(
    val name: String,
    val address: Address,  // ì¤‘ì²© ê°ì²´
    val employees: Int
)
```

---

**ë‹¤ìŒ í•™ìŠµ**: [4.2: ë¦¬ìŠ¤íŠ¸ ë° ë§µ íŒŒì‹±](../../README.md#42-ë¦¬ìŠ¤íŠ¸-ë°-ë§µ-íŒŒì‹±)

