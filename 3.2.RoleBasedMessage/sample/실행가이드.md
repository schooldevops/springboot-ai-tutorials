# ì—­í•  ê¸°ë°˜ ë©”ì‹œì§€ ìƒ˜í”Œ í”„ë¡œì íŠ¸ ì‹¤í–‰ ê°€ì´ë“œ

ì´ ê°€ì´ë“œëŠ” 3.2.RoleBasedMessage ìƒ˜í”Œ í”„ë¡œì íŠ¸ë¥¼ ì‹¤í–‰í•˜ê³  í…ŒìŠ¤íŠ¸í•˜ëŠ” ë°©ë²•ì„ ì•ˆë‚´í•©ë‹ˆë‹¤.

## ğŸ“‹ ì‚¬ì „ ì¤€ë¹„ì‚¬í•­

- JDK 17 ì´ìƒ ì„¤ì¹˜
- OpenAI API Key ë°œê¸‰
- í™˜ê²½ ë³€ìˆ˜ ì„¤ì • ê¶Œí•œ

## ğŸš€ ì‹¤í–‰ ë°©ë²•

### 1. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

í„°ë¯¸ë„ì—ì„œ API Keyë¥¼ í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì •:

**macOS / Linux:**
```bash
export OPENAI_API_KEY="sk-your-api-key-here"
```

**Windows (PowerShell):**
```powershell
$env:OPENAI_API_KEY="sk-your-api-key-here"
```

### 2. í”„ë¡œì íŠ¸ ì‹¤í–‰

```bash
./gradlew bootRun
```

ë˜ëŠ” IntelliJ IDEAì—ì„œ `RoleBasedMessageApplication.kt` ì‹¤í–‰

### 3. ì‹¤í–‰ í™•ì¸

ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì •ìƒì ìœ¼ë¡œ ì‹œì‘ë˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë©”ì‹œì§€ê°€ í‘œì‹œë©ë‹ˆë‹¤:

```
Started RoleBasedMessageApplication in X.XXX seconds
```

## ğŸ§ª API í…ŒìŠ¤íŠ¸

### ê¸°ë³¸ ë©”ì‹œì§€ íƒ€ì…

#### 1. SystemMessageë§Œ ì‚¬ìš©

```bash
curl http://localhost:8080/api/basic/system-only
```

#### 2. SystemMessage + UserMessage

```bash
curl -X POST http://localhost:8080/api/basic/system-user \
  -H "Content-Type: application/json" \
  -d '{"message": "ì•ˆë…•í•˜ì„¸ìš”!"}'
```

#### 3. ëŒ€í™” ì´ë ¥ í¬í•¨

```bash
curl -X POST http://localhost:8080/api/basic/conversation
```

### ì—­í•  ê¸°ë°˜ ì˜ˆì œ

#### 4. ì—­í•  ê¸°ë°˜ ì±„íŒ…

```bash
# ì„ ìƒë‹˜ ì—­í• 
curl -X POST http://localhost:8080/api/role/chat \
  -H "Content-Type: application/json" \
  -d '{
    "role": "teacher",
    "message": "ìˆ˜í•™ì„ ì–´ë–»ê²Œ ê³µë¶€í•˜ë©´ ì¢‹ì„ê¹Œìš”?"
  }'

# ì˜ì‚¬ ì—­í• 
curl -X POST http://localhost:8080/api/role/chat \
  -H "Content-Type: application/json" \
  -d '{
    "role": "doctor",
    "message": "ê°ê¸° ì˜ˆë°© ë°©ë²•ì€?"
  }'

# ê°œë°œì ì—­í• 
curl -X POST http://localhost:8080/api/role/chat \
  -H "Content-Type: application/json" \
  -d '{
    "role": "developer",
    "message": "ì˜ì¡´ì„± ì£¼ì…ì´ë€ ë¬´ì—‡ì¸ê°€ìš”?"
  }'
```

#### 5. ë™ì  ì—­í•  ì„¤ì •

```bash
curl -X POST http://localhost:8080/api/role/dynamic \
  -H "Content-Type: application/json" \
  -d '{
    "role": "ì½”ë”© íŠœí„°",
    "instructions": "ì´ˆë³´ìì—ê²Œ ì¹œì ˆí•˜ê²Œ ì„¤ëª…í•´ì£¼ì„¸ìš”.",
    "principles": ["ê°„ë‹¨í•˜ê²Œ", "ì˜ˆì‹œ í¬í•¨", "ì‹¤ìŠµ ì¶”ì²œ"],
    "message": "ë¦¬ìŠ¤íŠ¸ì™€ ë°°ì—´ì˜ ì°¨ì´ëŠ”?"
  }'
```

### Few-shot Prompting

#### 6. ê¸°ë³¸ Few-shot

```bash
curl -X POST http://localhost:8080/api/few-shot/basic \
  -H "Content-Type: application/json" \
  -d '{"question": "Kotlinì—ì„œ ë¦¬ìŠ¤íŠ¸ë¥¼ ì–´ë–»ê²Œ ë§Œë“œë‚˜ìš”?"}'
```

#### 7. í˜•ì‹ ì§€ì • Few-shot

```bash
curl -X POST http://localhost:8080/api/few-shot/format \
  -H "Content-Type: application/json" \
  -d '{"question": "ì˜ì¡´ì„± ì£¼ì…ì´ë€ ë¬´ì—‡ì¸ê°€ìš”?"}'
```

### ëŒ€í™” ì´ë ¥ ê´€ë¦¬

#### 8. ì„¸ì…˜ë³„ ëŒ€í™” ì‹œì‘

```bash
curl -X POST http://localhost:8080/api/conversation/session123 \
  -H "Content-Type: application/json" \
  -d '{"message": "ì•ˆë…•í•˜ì„¸ìš”"}'
```

**ì‘ë‹µ:**
```json
{
  "message": "ì•ˆë…•í•˜ì„¸ìš”! ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?",
  "sessionId": "session123"
}
```

#### 9. ëŒ€í™” ê³„ì†í•˜ê¸°

```bash
curl -X POST http://localhost:8080/api/conversation/session123 \
  -H "Content-Type: application/json" \
  -d '{"message": "Spring AIì— ëŒ€í•´ ì„¤ëª…í•´ì£¼ì„¸ìš”"}'
```

#### 10. ëŒ€í™” ì´ë ¥ ì¡°íšŒ

```bash
curl http://localhost:8080/api/conversation/session123
```

**ì‘ë‹µ:**
```json
{
  "sessionId": "session123",
  "messageCount": 5,
  "messages": [
    {"type": "SystemMessage", "content": "ë‹¹ì‹ ì€ ì¹œì ˆí•œ ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤."},
    {"type": "UserMessage", "content": "ì•ˆë…•í•˜ì„¸ìš”"},
    {"type": "AssistantMessage", "content": "ì•ˆë…•í•˜ì„¸ìš”! ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?"},
    ...
  ]
}
```

#### 11. ëŒ€í™” ì´ë ¥ ì´ˆê¸°í™”

```bash
curl -X DELETE http://localhost:8080/api/conversation/session123
```

#### 12. ëŒ€í™” ì´ë ¥ ê¸¸ì´ ì œí•œ

```bash
curl -X POST "http://localhost:8080/api/conversation/session123/limit?maxMessages=10"
```

### ì„œë¹„ìŠ¤ ê¸°ë°˜ ì˜ˆì œ

#### 13. ì„œë¹„ìŠ¤ë¥¼ í†µí•œ ì—­í•  ì±„íŒ…

```bash
curl -X POST http://localhost:8080/api/service/chat/teacher \
  -H "Content-Type: application/json" \
  -d '{"message": "ìˆ˜í•™ì„ ì–´ë–»ê²Œ ê³µë¶€í•˜ë©´ ì¢‹ì„ê¹Œìš”?"}'
```

#### 14. ì»¤ìŠ¤í…€ ì—­í• 

```bash
curl -X POST http://localhost:8080/api/service/custom \
  -H "Content-Type: application/json" \
  -d '{
    "role": "ë©˜í† ",
    "instructions": "ì‹¤ë¬´ ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ ì¡°ì–¸í•´ì£¼ì„¸ìš”.",
    "principles": ["í˜„ì‹¤ì ", "ì‹¤ìš©ì ", "êµ¬ì²´ì "],
    "message": "ì‹ ì… ê°œë°œìë¡œì„œ ë¬´ì—‡ì„ ì¤€ë¹„í•´ì•¼ í• ê¹Œìš”?"
  }'
```

## ğŸ“Š Postman ì‚¬ìš©

Postmanì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°:

### Collection ì˜ˆì‹œ

**1. ì—­í•  ê¸°ë°˜ ì±„íŒ…**
- Method: POST
- URL: `http://localhost:8080/api/role/chat`
- Body (JSON):
```json
{
  "role": "teacher",
  "message": "ìˆ˜í•™ì„ ì–´ë–»ê²Œ ê³µë¶€í•˜ë©´ ì¢‹ì„ê¹Œìš”?"
}
```

**2. ëŒ€í™” ì´ë ¥ ê´€ë¦¬**
- Method: POST
- URL: `http://localhost:8080/api/conversation/session123`
- Body:
```json
{
  "message": "ì•ˆë…•í•˜ì„¸ìš”"
}
```

## ğŸ” ë””ë²„ê¹…

### ë¡œê·¸ í™•ì¸

ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì‹œ ë¡œê·¸ë¥¼ í™•ì¸í•˜ì—¬ ë””ë²„ê¹…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```yaml
# application.ymlì— ì´ë¯¸ ì„¤ì •ë¨
logging:
  level:
    com.example.springai: DEBUG
    org.springframework.ai: DEBUG
```

### ë©”ì‹œì§€ ë‚´ìš© í™•ì¸

ì½”ë“œì— ë¡œê·¸ë¥¼ ì¶”ê°€í•˜ì—¬ ë©”ì‹œì§€ ë‚´ìš©ì„ í™•ì¸:

```kotlin
val messages = listOf(
    SystemMessage("ë‹¹ì‹ ì€ ì¹œì ˆí•œ ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤."),
    UserMessage(request.message)
)
println("Messages: $messages")  // ë””ë²„ê¹…ìš©
val prompt = Prompt(messages)
```

## âŒ ë¬¸ì œ í•´ê²°

### ë¬¸ì œ 1: API Key ì˜¤ë¥˜

**ì¦ìƒ:**
```
Error: API key not found
```

**í•´ê²°ì±…:**
1. í™˜ê²½ ë³€ìˆ˜ í™•ì¸: `echo $OPENAI_API_KEY`
2. ì• í”Œë¦¬ì¼€ì´ì…˜ ì¬ì‹œì‘

### ë¬¸ì œ 2: ì—­í• ì´ ë¬´ì‹œë¨

**ì¦ìƒ:**
```
LLMì´ SystemMessageì˜ ì—­í• ì„ ë”°ë¥´ì§€ ì•ŠìŒ
```

**í•´ê²°ì±…:**
- SystemMessageê°€ UserMessage **ì´ì „**ì— ìœ„ì¹˜í•˜ëŠ”ì§€ í™•ì¸
- SystemMessage ë‚´ìš©ì´ ëª…í™•í•œì§€ í™•ì¸

### ë¬¸ì œ 3: ëŒ€í™” ì´ë ¥ì´ ë„ˆë¬´ ê¸¸ì–´ì§

**ì¦ìƒ:**
```
í† í° ì œí•œ ì´ˆê³¼ ì˜¤ë¥˜
```

**í•´ê²°ì±…:**
```bash
# ëŒ€í™” ì´ë ¥ ê¸¸ì´ ì œí•œ
curl -X POST "http://localhost:8080/api/conversation/session123/limit?maxMessages=10"
```

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

ì‹¤í–‰ ì „ í™•ì¸ì‚¬í•­:

- [ ] JDK 17 ì´ìƒ ì„¤ì¹˜ë¨
- [ ] OpenAI API Key ë°œê¸‰ë¨
- [ ] í™˜ê²½ ë³€ìˆ˜ ì„¤ì •ë¨
- [ ] í”„ë¡œì íŠ¸ ë¹Œë“œ ì„±ê³µ (`./gradlew build`)
- [ ] ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì„±ê³µ (`./gradlew bootRun`)
- [ ] API ì—”ë“œí¬ì¸íŠ¸ ì‘ë‹µ í™•ì¸

## ğŸ“ í•™ìŠµ ê¶Œì¥ ìˆœì„œ

1. **ê¸°ë³¸ ë©”ì‹œì§€ íƒ€ì…**: `/api/basic/*` ì—”ë“œí¬ì¸íŠ¸ë“¤
2. **ì—­í•  ê¸°ë°˜**: `/api/role/*` ì—”ë“œí¬ì¸íŠ¸ë“¤
3. **Few-shot**: `/api/few-shot/*` ì—”ë“œí¬ì¸íŠ¸ë“¤
4. **ëŒ€í™” ì´ë ¥**: `/api/conversation/*` ì—”ë“œí¬ì¸íŠ¸ë“¤
5. **ì„œë¹„ìŠ¤ ë¶„ë¦¬**: `/api/service/*` ì—”ë“œí¬ì¸íŠ¸ë“¤
6. **ì½”ë“œ ë¶„ì„**: ê° ì»¨íŠ¸ë¡¤ëŸ¬ì™€ ì„œë¹„ìŠ¤ì˜ ì½”ë“œë¥¼ ì½ì–´ë³´ë©° í•™ìŠµ

## ğŸ“š í•µì‹¬ ê°œë… ì •ë¦¬

### ë©”ì‹œì§€ íƒ€ì… ì‚¬ìš© íŒ¨í„´

```kotlin
// 1. ë©”ì‹œì§€ êµ¬ì„±
val messages = listOf(
    SystemMessage("ë‹¹ì‹ ì€ ì¹œì ˆí•œ ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤."),
    UserMessage("ì•ˆë…•í•˜ì„¸ìš”!")
)

// 2. Prompt ìƒì„±
val prompt = Prompt(messages)

// 3. ChatModel í˜¸ì¶œ
val response = chatModel.call(prompt)
val text = response.results.firstOrNull()?.output?.text ?: "ì‘ë‹µ ì—†ìŒ"
```

### ì—­í•  ê¸°ë°˜ íŒ¨í„´

```kotlin
// ì—­í• ì— ë”°ë¥¸ SystemMessage ìƒì„±
val systemMessage = when (role) {
    "teacher" -> SystemMessage("ë‹¹ì‹ ì€ ì„ ìƒë‹˜ì…ë‹ˆë‹¤.")
    "doctor" -> SystemMessage("ë‹¹ì‹ ì€ ì˜ì‚¬ì…ë‹ˆë‹¤.")
    else -> SystemMessage("ë‹¹ì‹ ì€ ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤.")
}

val prompt = Prompt(listOf(
    systemMessage,
    UserMessage(message)
))
```

### Few-shot íŒ¨í„´

```kotlin
val messages = listOf(
    SystemMessage("ì—­í•  ì •ì˜"),
    UserMessage("ì˜ˆì‹œ ì§ˆë¬¸ 1"),
    AssistantMessage("ì˜ˆì‹œ ë‹µë³€ 1"),
    UserMessage("ì˜ˆì‹œ ì§ˆë¬¸ 2"),
    AssistantMessage("ì˜ˆì‹œ ë‹µë³€ 2"),
    UserMessage("ì‹¤ì œ ì§ˆë¬¸")
)
```

---

**ë‹¤ìŒ í•™ìŠµ**: [3.3: ê³ ê¸‰ PromptTemplate í™œìš©](../../README.md#33-ê³ ê¸‰-prompttemplate-í™œìš©)

