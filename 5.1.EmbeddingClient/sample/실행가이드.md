# EmbeddingClient ìƒ˜í”Œ í”„ë¡œì íŠ¸ ì‹¤í–‰ ê°€ì´ë“œ

ì´ ê°€ì´ë“œëŠ” 5.1.EmbeddingClient ìƒ˜í”Œ í”„ë¡œì íŠ¸ë¥¼ ì‹¤í–‰í•˜ê³  í…ŒìŠ¤íŠ¸í•˜ëŠ” ë°©ë²•ì„ ì•ˆë‚´í•©ë‹ˆë‹¤.

## ğŸ“‹ ì‚¬ì „ ì¤€ë¹„ì‚¬í•­

- JDK 17 ì´ìƒ ì„¤ì¹˜
- OpenAI API Key ë°œê¸‰
- í™˜ê²½ ë³€ìˆ˜ ì„¤ì • ê¶Œí•œ

## ğŸš€ ì‹¤í–‰ ë°©ë²•

### 1. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

í„°ë¯¸ë„ì—ì„œ API Keyë¥¼ í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì •:

**macOS / Linux:**
```bash
export OPENAI_API_KEY="sk-your-api-key-here"
```

**Windows (PowerShell):**
```powershell
$env:OPENAI_API_KEY="sk-your-api-key-here"
```

### 2. í”„ë¡œì íŠ¸ ì‹¤í–‰

```bash
./gradlew bootRun
```

ë˜ëŠ” IntelliJ IDEAì—ì„œ `EmbeddingClientApplication.kt` ì‹¤í–‰

### 3. ì‹¤í–‰ í™•ì¸

ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì •ìƒì ìœ¼ë¡œ ì‹œì‘ë˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë©”ì‹œì§€ê°€ í‘œì‹œë©ë‹ˆë‹¤:

```
Started EmbeddingClientApplication in X.XXX seconds
```

## ğŸ§ª API í…ŒìŠ¤íŠ¸

### ê¸°ë³¸ ì„ë² ë”© ì˜ˆì œ

#### 1. ë‹¨ì¼ í…ìŠ¤íŠ¸ ì„ë² ë”©

```bash
curl -X POST http://localhost:8080/api/embedding/embed \
  -H "Content-Type: application/json" \
  -d '{
    "text": "Spring AIëŠ” Spring í”„ë ˆì„ì›Œí¬ë¥¼ ìœ„í•œ AI í†µí•© ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤."
  }'
```

**ì˜ˆìƒ ì‘ë‹µ:**
```json
{
  "text": "Spring AIëŠ” Spring í”„ë ˆì„ì›Œí¬ë¥¼ ìœ„í•œ AI í†µí•© ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤.",
  "dimension": 1536,
  "embedding": [0.123, -0.456, ...],
  "sample": [0.123, -0.456, 0.789, -0.234, 0.567]
}
```

#### 2. ë°°ì¹˜ ì„ë² ë”© ìƒì„±

```bash
curl -X POST http://localhost:8080/api/embedding/embed-batch \
  -H "Content-Type: application/json" \
  -d '{
    "texts": ["í…ìŠ¤íŠ¸1", "í…ìŠ¤íŠ¸2", "í…ìŠ¤íŠ¸3"]
  }'
```

#### 3. ì„ë² ë”© ì •ë³´ í™•ì¸

```bash
curl http://localhost:8080/api/embedding/info
```

**ì˜ˆìƒ ì‘ë‹µ:**
```json
{
  "dimension": 1536,
  "sample": [0.123, -0.456, 0.789, -0.234, 0.567],
  "min": -1.0,
  "max": 1.0,
  "average": 0.0
}
```

### ë¬¸ì„œ ë¶„í•  ë° ì„ë² ë”©

#### 4. ë¬¸ì„œ ì„ë² ë”©

```bash
curl -X POST http://localhost:8080/api/document-embedding/embed-document \
  -H "Content-Type: application/json" \
  -d '{
    "text": "ê¸´ ë¬¸ì„œ í…ìŠ¤íŠ¸ì…ë‹ˆë‹¤...",
    "chunkSize": 500
  }'
```

### ì‹œë§¨í‹± ê²€ìƒ‰ ì˜ˆì œ

#### 5. ë¬¸ì„œ ì¶”ê°€

```bash
curl -X POST http://localhost:8080/api/semantic-search/add \
  -H "Content-Type: application/json" \
  -d '{
    "id": "doc1",
    "text": "Spring AIëŠ” Spring í”„ë ˆì„ì›Œí¬ë¥¼ ìœ„í•œ AI í†µí•© ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤."
  }'
```

#### 6. ê²€ìƒ‰

```bash
curl -X POST http://localhost:8080/api/semantic-search/search \
  -H "Content-Type: application/json" \
  -d '{
    "query": "í”„ë¡œê·¸ë˜ë°",
    "topK": 5
  }'
```

**ì˜ˆìƒ ì‘ë‹µ:**
```json
{
  "query": "í”„ë¡œê·¸ë˜ë°",
  "topK": 5,
  "results": [
    {
      "id": "doc1",
      "text": "Spring AIëŠ”...",
      "similarity": 0.85
    }
  ]
}
```

## ğŸ” ë””ë²„ê¹…

### ë¡œê·¸ í™•ì¸

ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì‹œ ë¡œê·¸ë¥¼ í™•ì¸í•˜ì—¬ ë””ë²„ê¹…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```yaml
# application.ymlì— ì´ë¯¸ ì„¤ì •ë¨
logging:
  level:
    com.example.springai: DEBUG
    org.springframework.ai: DEBUG
```

## âŒ ë¬¸ì œ í•´ê²°

### ë¬¸ì œ 1: API Key ì˜¤ë¥˜

**ì¦ìƒ:**
```
No qualifying bean of type 'EmbeddingModel' available
```

**í•´ê²°ì±…:**
1. í™˜ê²½ ë³€ìˆ˜ í™•ì¸: `echo $OPENAI_API_KEY`
2. application.ymlì—ì„œ API Key ì„¤ì • í™•ì¸

### ë¬¸ì œ 2: ì„ë² ë”© ì°¨ì› ë¶ˆì¼ì¹˜

**ì¦ìƒ:**
```
ì˜ˆìƒê³¼ ë‹¤ë¥¸ ì°¨ì› ìˆ˜
```

**í•´ê²°ì±…:**
- OpenAI ëª¨ë¸ë³„ ì°¨ì› í™•ì¸:
  - text-embedding-ada-002: 1536ì°¨ì›
  - text-embedding-3-small: 1536ì°¨ì›
  - text-embedding-3-large: 3072ì°¨ì›

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

ì‹¤í–‰ ì „ í™•ì¸ì‚¬í•­:

- [ ] JDK 17 ì´ìƒ ì„¤ì¹˜ë¨
- [ ] OpenAI API Key ë°œê¸‰ë¨
- [ ] í™˜ê²½ ë³€ìˆ˜ ì„¤ì •ë¨
- [ ] í”„ë¡œì íŠ¸ ë¹Œë“œ ì„±ê³µ (`./gradlew build`)
- [ ] ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì„±ê³µ (`./gradlew bootRun`)
- [ ] API ì—”ë“œí¬ì¸íŠ¸ ì‘ë‹µ í™•ì¸

## ğŸ“ í•™ìŠµ ê¶Œì¥ ìˆœì„œ

1. **ê¸°ë³¸ ì„ë² ë”©**: `/api/embedding/*` ì—”ë“œí¬ì¸íŠ¸ë“¤
2. **ë¬¸ì„œ ë¶„í• **: `/api/document-embedding/*` ì—”ë“œí¬ì¸íŠ¸ë“¤
3. **ì‹œë§¨í‹± ê²€ìƒ‰**: `/api/semantic-search/*` ì—”ë“œí¬ì¸íŠ¸ë“¤
4. **ì½”ë“œ ë¶„ì„**: EmbeddingModel êµ¬í˜„ ë° ì½”ì‚¬ì¸ ìœ ì‚¬ë„ ê³„ì‚° í™•ì¸

## ğŸ“š í•µì‹¬ ê°œë… ì •ë¦¬

### EmbeddingModel ì‚¬ìš© íŒ¨í„´

```kotlin
// 1. EmbeddingModel ì£¼ì…
@RestController
class EmbeddingController(
    private val embeddingModel: EmbeddingModel
) {
    // 2. ë‹¨ì¼ í…ìŠ¤íŠ¸ ì„ë² ë”©
    fun embed(text: String): FloatArray {
        return embeddingModel.embed(text)
    }
    
    // 3. ë°°ì¹˜ ì„ë² ë”©
    fun embedBatch(texts: List<String>): List<FloatArray> {
        return embeddingModel.embed(texts)
    }
}
```

### ì½”ì‚¬ì¸ ìœ ì‚¬ë„ ê³„ì‚°

```kotlin
private fun cosineSimilarity(a: FloatArray, b: FloatArray): Double {
    if (a.size != b.size) return 0.0
    
    val dotProduct = a.zip(b).sumOf { (x, y) -> (x * y).toDouble() }
    val normA = kotlin.math.sqrt(a.sumOf { (it * it).toDouble() })
    val normB = kotlin.math.sqrt(b.sumOf { (it * it).toDouble() })
    
    return if (normA > 0.0 && normB > 0.0) {
        dotProduct / (normA * normB)
    } else {
        0.0
    }
}
```

---

**ë‹¤ìŒ í•™ìŠµ**: [5.2: í…ìŠ¤íŠ¸ ìœ ì‚¬ë„ ê³„ì‚°](../../README.md#52-í…ìŠ¤íŠ¸-ìœ ì‚¬ë„-ê³„ì‚°)

