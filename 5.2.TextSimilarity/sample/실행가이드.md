# 텍스트 유사도 계산 샘플 프로젝트 실행 가이드

이 가이드는 5.2.TextSimilarity 샘플 프로젝트를 실행하고 테스트하는 방법을 안내합니다.

## 📋 사전 준비사항

- JDK 17 이상 설치
- OpenAI API Key 발급
- 환경 변수 설정 권한

## 🚀 실행 방법

### 1. 환경 변수 설정

터미널에서 API Key를 환경 변수로 설정:

**macOS / Linux:**
```bash
export OPENAI_API_KEY="sk-your-api-key-here"
```

**Windows (PowerShell):**
```powershell
$env:OPENAI_API_KEY="sk-your-api-key-here"
```

### 2. 프로젝트 실행

```bash
./gradlew bootRun
```

또는 IntelliJ IDEA에서 `TextSimilarityApplication.kt` 실행

### 3. 실행 확인

애플리케이션이 정상적으로 시작되면 다음과 같은 메시지가 표시됩니다:

```
Started TextSimilarityApplication in X.XXX seconds
```

## 🧪 API 테스트

### 기본 유사도 계산

#### 1. 두 텍스트 간 유사도

```bash
curl -X POST http://localhost:8080/api/similarity/calculate \
  -H "Content-Type: application/json" \
  -d '{
    "text1": "Spring AI는 프레임워크입니다.",
    "text2": "Spring AI는 라이브러리입니다."
  }'
```

**예상 응답:**
```json
{
  "text1": "Spring AI는 프레임워크입니다.",
  "text2": "Spring AI는 라이브러리입니다.",
  "similarity": 0.85,
  "similarityPercent": 85.0,
  "interpretation": "유사"
}
```

### 여러 텍스트 비교

#### 2. 쿼리와 여러 텍스트 비교

```bash
curl -X POST http://localhost:8080/api/similarity/multiple/compare \
  -H "Content-Type: application/json" \
  -d '{
    "query": "프로그래밍",
    "texts": ["코딩", "개발", "요리", "음악"]
  }'
```

**예상 응답:**
```json
{
  "query": "프로그래밍",
  "totalTexts": 4,
  "results": [
    {
      "index": 0,
      "text": "코딩",
      "similarity": 0.92,
      "similarityPercent": 92.0,
      "interpretation": "매우 유사"
    },
    {
      "index": 1,
      "text": "개발",
      "similarity": 0.88,
      "similarityPercent": 88.0,
      "interpretation": "유사"
    }
  ],
  "mostSimilar": {
    "text": "코딩",
    "similarity": 0.92,
    "similarityPercent": 92.0
  }
}
```

### 모든 쌍 비교

#### 3. 모든 텍스트 쌍의 유사도

```bash
curl -X POST http://localhost:8080/api/similarity/pairwise/calculate \
  -H "Content-Type: application/json" \
  -d '{
    "texts": ["코딩", "프로그래밍", "개발", "요리"]
  }'
```

### 임계값 필터링

#### 4. 임계값 이상의 유사 텍스트 찾기

```bash
curl -X POST http://localhost:8080/api/similarity/threshold/filter \
  -H "Content-Type: application/json" \
  -d '{
    "query": "프로그래밍",
    "texts": ["코딩", "개발", "요리", "음악"],
    "threshold": 0.7
  }'
```

### Top-K 검색

#### 5. 유사도 높은 상위 K개 찾기

```bash
curl -X POST http://localhost:8080/api/similarity/topk/find \
  -H "Content-Type: application/json" \
  -d '{
    "query": "인공지능",
    "texts": ["AI", "머신러닝", "딥러닝", "데이터 과학", "웹 개발"],
    "topK": 3
  }'
```

**예상 응답:**
```json
{
  "query": "인공지능",
  "topK": 3,
  "totalTexts": 5,
  "results": [
    {
      "rank": 1,
      "text": "AI",
      "similarity": 0.98,
      "similarityPercent": 98.0
    },
    {
      "rank": 2,
      "text": "머신러닝",
      "similarity": 0.85,
      "similarityPercent": 85.0
    },
    {
      "rank": 3,
      "text": "딥러닝",
      "similarity": 0.82,
      "similarityPercent": 82.0
    }
  ]
}
```

### 고급 기능

#### 6. 중복 문서 검사

```bash
curl -X POST http://localhost:8080/api/similarity/advanced/duplicates \
  -H "Content-Type: application/json" \
  -d '{
    "texts": [
      "Spring AI는 프레임워크입니다.",
      "Spring AI는 라이브러리입니다.",
      "Spring AI는 프레임워크입니다."
    ],
    "threshold": 0.95
  }'
```

#### 7. 텍스트 클러스터링

```bash
curl -X POST http://localhost:8080/api/similarity/advanced/cluster \
  -H "Content-Type: application/json" \
  -d '{
    "texts": [
      "코딩", "프로그래밍", "개발",
      "요리", "음식", "레시피",
      "음악", "노래", "가수"
    ],
    "similarityThreshold": 0.7
  }'
```

## 🔍 디버깅

### 로그 확인

애플리케이션 실행 시 로그를 확인하여 디버깅할 수 있습니다:

```yaml
# application.yml에 이미 설정됨
logging:
  level:
    com.example.springai: DEBUG
    org.springframework.ai: DEBUG
```

## ❌ 문제 해결

### 문제 1: 유사도가 항상 낮음

**증상:**
```
모든 유사도가 0.5 이하
```

**해결책:**
- 동일한 텍스트로 테스트하여 1.0에 가까운지 확인
- 임베딩 모델 확인
- 임계값 조정

### 문제 2: 유사도 계산 오류

**증상:**
```
NaN 또는 Infinity 값
```

**해결책:**
- SimilarityUtils의 코사인 유사도 함수 확인
- 벡터 크기 검증 추가

## ✅ 체크리스트

실행 전 확인사항:

- [ ] JDK 17 이상 설치됨
- [ ] OpenAI API Key 발급됨
- [ ] 환경 변수 설정됨
- [ ] 프로젝트 빌드 성공 (`./gradlew build`)
- [ ] 애플리케이션 실행 성공 (`./gradlew bootRun`)
- [ ] API 엔드포인트 응답 확인

## 🎓 학습 권장 순서

1. **기본 유사도**: `/api/similarity/calculate`
2. **여러 텍스트 비교**: `/api/similarity/multiple/compare`
3. **임계값 필터링**: `/api/similarity/threshold/filter`
4. **Top-K 검색**: `/api/similarity/topk/find`
5. **고급 기능**: `/api/similarity/advanced/*`
6. **코드 분석**: SimilarityUtils의 코사인 유사도 계산 확인

## 📚 핵심 개념 정리

### 코사인 유사도 계산 패턴

```kotlin
// 1. 텍스트 임베딩 생성
val embedding1 = embeddingModel.embed(text1)
val embedding2 = embeddingModel.embed(text2)

// 2. 코사인 유사도 계산
val similarity = SimilarityUtils.cosineSimilarity(embedding1, embedding2)

// 3. 결과 해석
val interpretation = SimilarityUtils.interpretSimilarity(similarity)
```

### 유사도 해석 가이드

```kotlin
when {
    similarity >= 0.9 -> "매우 유사"
    similarity >= 0.7 -> "유사"
    similarity >= 0.5 -> "보통"
    similarity >= 0.3 -> "다소 다름"
    else -> "다름"
}
```

### 임계값 선택 가이드

- **중복 검사**: 0.95 이상
- **유사 문서 검색**: 0.7 이상
- **관련 문서 검색**: 0.5 이상
- **관련성 필터링**: 0.3 이상

---

**다음 학습**: [6.1: 벡터 저장소의 필요성](../../README.md#61-벡터-저장소의-필요성)

